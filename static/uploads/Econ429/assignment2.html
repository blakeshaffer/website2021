<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Assignment 2</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.5.1/jquery-3.5.1.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Econ 429 Data Assignments</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Introduction to R</a>
</li>
<li>
  <a href="assignment1.html">Assignment 1</a>
</li>
<li>
  <a href="assignment2.html">Assignment 2</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Assignment 2</h1>

</div>


<hr />
<p><strong>Hello again class!</strong></p>
<p>For your second data assignment, you will do three tasks:</p>
<ol style="list-style-type: decimal">
<li>Analyze Alberta Internal Load (AIL) data</li>
<li>Analyze the effect of renewables on net load</li>
<li>Analyze the relationship between pool price and generation for
different fuel types</li>
</ol>
<p>You can do this in either a) an rMarkdown script like this (which
includes both code and output) or b) using RStudio’s script to write
your code in a .r file and save your plots</p>
<div id="task-1-load-data" class="section level1">
<h1>Task 1: Load data</h1>
<p>Start by pulling in 1 year of Alberta Internal Load data, from Jan 1,
2022 to Dec 31, 2022. I’m going to use the API, but you can also pull
this using the aeso’s market and system reporting historical pool price
report. Up to you!</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#aeso_key = &quot;enter_your_key_here&quot; (make sure to uncomment and run this line with your key!)</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>get_AESO_load <span class="ot">&lt;-</span> <span class="cf">function</span>(start_date,end_date,aeso_key){</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="at">url=</span><span class="st">&quot;https://api.aeso.ca/report/v1/load/albertaInternalLoad&quot;</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>              <span class="fu">add_headers</span>(<span class="st">&quot;X-API-Key&quot;</span> <span class="ot">=</span> aeso_key),</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">query =</span> <span class="fu">list</span>(</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">startDate =</span> <span class="fu">format</span>(start_date, <span class="st">&quot;%Y-%m-%d&quot;</span>),</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">endDate =</span> <span class="fu">format</span>(end_date, <span class="st">&quot;%Y-%m-%d&quot;</span>),</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">contentType =</span> <span class="st">&quot;application/json&quot;</span>))</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(data<span class="sc">$</span>content)))</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>df.load <span class="ot">&lt;-</span> <span class="fu">get_AESO_load</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2022-01-01&quot;</span>),<span class="fu">as.Date</span>(<span class="st">&quot;2022-12-31&quot;</span>),aeso_key)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>df.load <span class="ot">&lt;-</span> df.load <span class="sc">%&gt;%</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">datetime=</span>return.Actual.Forecast.Report.begin_datetime_mpt,</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">load=</span>return.Actual.Forecast.Report.alberta_internal_load) <span class="sc">%&gt;%</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">datetime=</span><span class="fu">ymd_hm</span>(datetime),</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">load=</span><span class="fu">as.numeric</span>(load))</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df.load)</span></code></pre></div>
<pre><code>##              datetime  load
## 1 2022-01-01 00:00:00 10746
## 2 2022-01-01 01:00:00 10618
## 3 2022-01-01 02:00:00 10499
## 4 2022-01-01 03:00:00 10451
## 5 2022-01-01 04:00:00 10408
## 6 2022-01-01 05:00:00 10401</code></pre>
<p>Great! That looks good. You should have a dataframe
(<code>df.load</code>) with 8760 rows of datetime and load data.</p>
<p>Now I want you to do four things with these data:</p>
<ol style="list-style-type: lower-alpha">
<li><p>Plot average monthly load for 2022. Include data labels
(<code>geom_text</code>) in your plots.</p></li>
<li><p>Plot average hourly load for 2022. i.e. this plot should have 24
hours along the x axis and the average load for each hour in 2022 along
the y axis.</p></li>
<li><p>Now do this again (average hourly load) but this time
<code>group_by(month)</code> first and plot the average hourly load for
each month in 2022 using <code>facet_wrap(~month)</code>.</p></li>
<li><p>Order your data frame from highest to lowest load value. Create a
new variable that runs from 1 to 8760 denoting the ranking of each hours
load (i.e. highest load in the year should have a 1 value, lowest should
have a value of 8760). Plot the load duration curve for 2022 with the
load on the y-axis and the hour order variable (highest to lowest) on
the x-axis.</p></li>
</ol>
<p>When done, part (d) should look like this:</p>
<p><img src="assignment2_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="task-2-net-load" class="section level1">
<h1>Task 2: Net Load</h1>
<p>For this task, I want you to calculate the <em>net load</em> for each
hour, i.e. load minus variable wind and solar generation. To do so, we
will need to pull in solar and wind generation data. Thankfully, the
AESO just started posting historical generation data by plant and fuel
type on their website: [<a
href="https://aeso.ca/market/market-and-system-reporting/data-requests/historical-generation-data/"
class="uri">https://aeso.ca/market/market-and-system-reporting/data-requests/historical-generation-data/</a>].</p>
<p>Grab the two files with 2022 data. You’ll need to download the zip
files, then unzip each to get csv files. Save it in the same folder as
your R script file and then you should be able to import it as two files
and merge them one on top of the other using <code>bind_rows</code>.
Once you have that, clean it up by renaming <code>Date (MPT)</code> to
<code>datetime</code> and rolling up the plant-level data to just give
us the sum of volume (MW) by fuel type in each hour.</p>
<p>In the end, you should get something like this:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df.gen <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&quot;dfgen.csv&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Note: I had to make an intermediary small csv file that fit under my website host&#39;s filesize limit. You&#39;ll be working directly with the AESO data like this:</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#data1 &lt;- readr::read_csv(&quot;CSD Generation (Hourly) - 2022-01 to 2022-06.csv&quot;)</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#data2 &lt;- readr::read_csv(&quot;CSD Generation (Hourly) - 2022-07 to 2022-12.csv&quot;)</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#df.gen &lt;- bind_rows(data1,data2) %&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#rename(datetime=`Date (MPT)`) %&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#group_by(datetime,`Fuel Type`) %&gt;%</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summarise(Volume=sum(Volume))</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df.gen)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   datetime            `Fuel Type`     Volume
##   &lt;dttm&gt;              &lt;chr&gt;            &lt;dbl&gt;
## 1 2022-01-01 00:00:00 COAL           1680.  
## 2 2022-01-01 00:00:00 DUAL FUEL        64.7 
## 3 2022-01-01 00:00:00 ENERGY STORAGE   -1.12
## 4 2022-01-01 00:00:00 GAS            7296.  
## 5 2022-01-01 00:00:00 HYDRO           111.  
## 6 2022-01-01 00:00:00 OTHER           281.</code></pre>
<p>Since we have these data, let’s start by producing a quick chart of
hourly generation by fuel type like this:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df.gen, <span class="fu">aes</span>(datetime,Volume,<span class="at">color=</span><span class="st">`</span><span class="at">Fuel Type</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span><span class="st">`</span><span class="at">Fuel Type</span><span class="st">`</span>)<span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_colorblind</span>()</span></code></pre></div>
<p><img src="assignment2_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>I see some weirdness in the data. That spike in GAS to 14000 MW
doesn’t make sense. It looks like the AESO has an issue on Nov 6 at 1am.
Let’s delete that hour and replot:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df.gen <span class="ot">&lt;-</span> df.gen <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(datetime<span class="sc">!=</span><span class="fu">ymd_hm</span>(<span class="st">&quot;2022-11-06 01:00&quot;</span>))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df.gen, <span class="fu">aes</span>(datetime,Volume,<span class="at">color=</span><span class="st">`</span><span class="at">Fuel Type</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span><span class="st">`</span><span class="at">Fuel Type</span><span class="st">`</span>)<span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_colorblind</span>()</span></code></pre></div>
<p><img src="assignment2_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Better. To see the variation better we could let the scales differ
for each facet. Note: this needs to be done judiciously, as you lose the
perspective on different generation levels across fuel types. This
should only be done if the focus is on shape or variation, not
levels.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df.gen, <span class="fu">aes</span>(datetime,Volume,<span class="at">color=</span><span class="st">`</span><span class="at">Fuel Type</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span><span class="st">`</span><span class="at">Fuel Type</span><span class="st">`</span>,<span class="at">scales=</span><span class="st">&quot;free_y&quot;</span>)<span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_colorblind</span>()</span></code></pre></div>
<p><img src="assignment2_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Ok! Now we’re ready for the task at hand:</p>
<ol style="list-style-type: lower-alpha">
<li>Plot the net load duration curve and regular (gross) load duration
curve on the same plot. This requires merging in the wind+solar (summed)
generation for each hour to your load dataframe, then calculating a net
load as <code>load</code> minus <code>renewables</code> for each hour.
You’ll also need to create 2 order variables: one for the regular load
values and another for the net load. I’ll let you figure that out, but
your final ggplot should look something like this, where the aesthetics
are in the <code>geom_line()</code> call:</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df.duration.net)<span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>order,<span class="at">y=</span>load,<span class="at">color=</span><span class="st">&quot;load&quot;</span>),<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>net.order,<span class="at">y=</span>net.load,<span class="at">color=</span><span class="st">&quot;net load&quot;</span>),<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_colorblind</span>(<span class="at">name=</span><span class="st">&quot;&quot;</span>)<span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;MWh&quot;</span>,<span class="at">x=</span><span class="st">&quot;Hour&quot;</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="st">&quot;Load duration curve for Alberta (2022)&quot;</span>)</span></code></pre></div>
<p><img src="assignment2_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Next, answer the question: what would the load duration curve look
like if there had been <strong>twice</strong> the renewable generation
last year? Do this by doubling the observed renewable generation each
hour and subtracting this hypothetical <em>2x VRE</em> value from
observed load.</li>
</ol>
<p>Your plot should now look like this:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df.duration.net)<span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>order,<span class="at">y=</span>load,<span class="at">color=</span><span class="st">&quot;load&quot;</span>),<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>net.order,<span class="at">y=</span>net.load,<span class="at">color=</span><span class="st">&quot;net load&quot;</span>),<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>net.order<span class="fl">.2</span>x,<span class="at">y=</span>net.load<span class="fl">.2</span>x,<span class="at">color=</span><span class="st">&quot;net load (2x VRE)&quot;</span>),<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_colorblind</span>(<span class="at">name=</span><span class="st">&quot;&quot;</span>)<span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;MWh&quot;</span>,<span class="at">x=</span><span class="st">&quot;Hours in year&quot;</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="st">&quot;Load duration curve for Alberta (2022)&quot;</span>)</span></code></pre></div>
<p><img src="assignment2_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<ol start="3" style="list-style-type: lower-alpha">
<li>What multiple of 2022 renewable generation would have been required
for the net load to have gone <em>negative</em> in at least some hours?
Do this by plotting more and more multiples (e.g. 2x, 3x, etc…) until
you see the net load by negative. <strong>What options should Alberta
consider to deal with such a situation?</strong></li>
</ol>
</div>
<div id="task-3-gen-and-price-data" class="section level1">
<h1>Task 3: Gen and Price data</h1>
<p>For this final task, I want you to explore the relationship between
hourly generation and hourly prices, by fuel type.</p>
<p>To do this task, we will need to dig back to our assignment 1 and
pull in 2022’s hourly prices. You can do this either using the API, or
getting it manually from the AESO’s market reporting page.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>get_AESO_prices <span class="ot">&lt;-</span> <span class="cf">function</span>(start_date,end_date,aeso_key){</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="at">url=</span><span class="st">&quot;https://api.aeso.ca/report/v1.1/price/poolPrice&quot;</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">add_headers</span>(<span class="st">&quot;X-API-Key&quot;</span> <span class="ot">=</span> aeso_key),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">query =</span> <span class="fu">list</span>(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">startDate =</span> <span class="fu">format</span>(start_date, <span class="st">&quot;%Y-%m-%d&quot;</span>),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">endDate =</span> <span class="fu">format</span>(end_date, <span class="st">&quot;%Y-%m-%d&quot;</span>),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">contentType =</span> <span class="st">&quot;application/json&quot;</span>))</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(data<span class="sc">$</span>content)))</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>df.price <span class="ot">&lt;-</span> <span class="fu">get_AESO_prices</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2022-01-01&quot;</span>),<span class="fu">as.Date</span>(<span class="st">&quot;2022-12-31&quot;</span>),aeso_key)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>df.price <span class="ot">&lt;-</span> df.price <span class="sc">%&gt;%</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">datetime=</span>return.Pool.Price.Report.begin_datetime_mpt,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">price=</span>return.Pool.Price.Report.pool_price) <span class="sc">%&gt;%</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">datetime=</span><span class="fu">ymd_hm</span>(datetime),</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">price=</span><span class="fu">as.numeric</span>(price))</span></code></pre></div>
<p>Once that is done, merge the price data with the gen data. We will
also get rid of the ENERGY STORAGE fuel type as it operates primarily in
the ancillary service markets right now and makes the data a little
messy for our purposes…</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df.price.gen <span class="ot">&lt;-</span> df.price <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df.gen, <span class="at">by=</span><span class="st">&quot;datetime&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">Fuel Type</span><span class="st">`</span><span class="sc">!=</span><span class="st">&quot;ENERGY STORAGE&quot;</span>)</span></code></pre></div>
<p>Now for your tasks:</p>
<ol style="list-style-type: lower-alpha">
<li>Start by simply plotting hourly generation (x-axis) against hourly
price (y-axis) by fuel type (<code>facet_wrap(~</code>Fuel
Type<code>)</code>). It should look something like this. I’ve chosen to
let the scales differ so you can see the relationships better.</li>
</ol>
<p><img src="assignment2_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Now i want you to calculate the <strong>generation-weighted
price</strong> for each fuel type. That is, calculate the sum of hourly
price x hourly volume, divided by the sum of volume, for each fuel type.
Once you have this, I want you to calculate the ratio of the
generation-weighted price to the simple average price for 2022. This
should give you a premium (&gt;100%) or discount (&lt;100%) for each
fuel type. Your final plot should look something like this:</li>
</ol>
<p><img src="assignment2_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p><strong>Good luck!</strong></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>

<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Assignment 1</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.5.1/jquery-3.5.1.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Econ 429 Data Assignments</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Introduction to R</a>
</li>
<li>
  <a href="assignment1.html">Assignment 1</a>
</li>
<li>
  <a href="assignment2.html">Assignment 2</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Assignment 1</h1>

</div>


<hr />
<p><strong>Hello class!</strong></p>
<p>For your first data assignment, you will do two tasks:</p>
<ol style="list-style-type: decimal">
<li>Analyze pool price data</li>
<li>Plot the merit order for a selection of hours</li>
</ol>
<p>You can do this in either a) an rMarkdown script like this (which
includes both code and output) or b) using RStudio’s script to write
your code in a .r file and save your plots</p>
<div id="task-1-price-data" class="section level1">
<h1>Task 1: Price data</h1>
<p>Start by pulling in 1 year of pool price data, from Jan 1, 2022 to
Dec 31, 2022. I’m going to use the API, but you can also pull this using
the aeso’s market and system reporting historical pool price report. Up
to you!</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#aeso_key = &quot;enter_your_key_here&quot; (make sure to uncomment and run this line with your key!)</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>start_date<span class="ot">&lt;-</span><span class="fu">as.Date</span>(<span class="st">&quot;2022-01-01&quot;</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>end_date<span class="ot">&lt;-</span><span class="fu">as.Date</span>(<span class="st">&quot;2022-12-31&quot;</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>get_AESO_data <span class="ot">&lt;-</span> <span class="cf">function</span>(start_date,end_date,aeso_key){</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="at">url=</span><span class="st">&quot;https://api.aeso.ca/report/v1.1/price/poolPrice&quot;</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_headers</span>(<span class="st">&quot;X-API-Key&quot;</span> <span class="ot">=</span> aeso_key),</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">query =</span> <span class="fu">list</span>(</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">startDate =</span> <span class="fu">format</span>(start_date, <span class="st">&quot;%Y-%m-%d&quot;</span>),</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">endDate =</span> <span class="fu">format</span>(end_date, <span class="st">&quot;%Y-%m-%d&quot;</span>),</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">contentType =</span> <span class="st">&quot;application/json&quot;</span>))</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(data<span class="sc">$</span>content)))</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(data)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">get_AESO_data</span>(start_date,end_date,aeso_key)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code></pre></div>
<pre><code>##                      timestamp responseCode
## 1 2023-01-30 22:36:33.484+0000          200
## 2 2023-01-30 22:36:33.484+0000          200
## 3 2023-01-30 22:36:33.484+0000          200
## 4 2023-01-30 22:36:33.484+0000          200
## 5 2023-01-30 22:36:33.484+0000          200
## 6 2023-01-30 22:36:33.484+0000          200
##   return.Pool.Price.Report.begin_datetime_utc
## 1                            2022-01-01 07:00
## 2                            2022-01-01 08:00
## 3                            2022-01-01 09:00
## 4                            2022-01-01 10:00
## 5                            2022-01-01 11:00
## 6                            2022-01-01 12:00
##   return.Pool.Price.Report.begin_datetime_mpt
## 1                            2022-01-01 00:00
## 2                            2022-01-01 01:00
## 3                            2022-01-01 02:00
## 4                            2022-01-01 03:00
## 5                            2022-01-01 04:00
## 6                            2022-01-01 05:00
##   return.Pool.Price.Report.pool_price
## 1                               65.64
## 2                               61.59
## 3                               56.67
## 4                               45.58
## 5                               57.39
## 6                               58.11
##   return.Pool.Price.Report.forecast_pool_price
## 1                                        68.22
## 2                                        63.52
## 3                                        54.71
## 4                                        51.36
## 5                                         59.3
## 6                                        58.71
##   return.Pool.Price.Report.rolling_30day_avg
## 1                                     127.10
## 2                                     127.10
## 3                                     127.11
## 4                                     127.12
## 5                                     127.12
## 6                                     127.12</code></pre>
<p>Let’s tidy this up a bit by renaming and keeping only the two columns
of data we want: the date and the price:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">datetime=</span>return.Pool.Price.Report.begin_datetime_mpt,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">price=</span>return.Pool.Price.Report.pool_price)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code></pre></div>
<pre><code>##           datetime price
## 1 2022-01-01 00:00 65.64
## 2 2022-01-01 01:00 61.59
## 3 2022-01-01 02:00 56.67
## 4 2022-01-01 03:00 45.58
## 5 2022-01-01 04:00 57.39
## 6 2022-01-01 05:00 58.11</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    8760 obs. of  2 variables:
##  $ datetime: chr  &quot;2022-01-01 00:00&quot; &quot;2022-01-01 01:00&quot; &quot;2022-01-01 02:00&quot; &quot;2022-01-01 03:00&quot; ...
##  $ price   : chr  &quot;65.64&quot; &quot;61.59&quot; &quot;56.67&quot; &quot;45.58&quot; ...</code></pre>
<p>Before we continue, there’s a problem with these data types. Check
out what they are. Are these plottable? Do you see the issue?</p>
<p><code>Mutate</code> these variables to a datetime
(<code>POSIXct</code>) class using the <code>lubridate</code>
<code>ymd_hm()</code> command and a numeric variable
(<code>as_numeric()</code>). I’ll leave that bit of code to you but if
done correctly you should get the following data classes:</p>
<pre><code>## &#39;data.frame&#39;:    8760 obs. of  2 variables:
##  $ datetime: POSIXct, format: &quot;2022-01-01 00:00:00&quot; &quot;2022-01-01 01:00:00&quot; ...
##  $ price   : num  65.6 61.6 56.7 45.6 57.4 ...</code></pre>
<p>Sweet. Let’s make an ugly plot of 8760 hours of prices in 2022…</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df,<span class="fu">aes</span>(<span class="at">x=</span>datetime,<span class="at">y=</span>price))<span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="assignment1_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Ugh. So ugly. Let’s do something more useful…</p>
<p>Now is where I want you to complete Task 1. I want you to produce the
following more interesting (and more legible) charts:</p>
<ol style="list-style-type: lower-alpha">
<li><strong>Plot the last 14 days of December 2022 hourly
prices</strong></li>
<li><strong>Plot monthly average prices for 2022 as a column chart,
include labels for the prices</strong></li>
<li><strong>Plot average prices by hour for 2022, i.e. on the x-axis of
your plot should be the hours 1 through 24, with the y-axis value being
the average price in each hour for 2022). Annotate the highest hourly
average price (which hour, what price?).</strong></li>
<li><strong>Like (c) but this time do the averages and plots separately
by month (hint: check out the <code>facet_wrap</code>
command)</strong></li>
<li><strong>Now i want you to go back and pull 3 years of data. Plot the
hourly price shape (like in (c)) but for summer months only
(June-August; not by month, average over all hours in these months) for
2020, 2021, 2022. Make each year’s summer data be a separate coloured
line. How have the hourly price shapes changed?</strong></li>
<li><strong>Extend plot (e) to deal with the changes in <em>levels</em>
from year to year so we can really focus on the hourly shape. Make the
y-axis be the price for any given hour divided by the average price in
that summer</strong></li>
</ol>
<p>The following commands will be your friend: * <code>filter</code>
allows you to subset the data * <code>group_by</code> allows you to do
things like monthly averages * <code>summarise</code> allows you to do
some statistical calculations, like averages!</p>
<p>For example
<code>new.df &lt;- df %&gt;% mutate(month=month(datetime) %&gt;% group_by(month) %&gt;% summarise(price=mean(price))</code>
will give you a 12x2 dataframe of months and monthly average prices.</p>
<p><strong>Hand in your Task 1 either as a rMarkdown file (advanced!) or
pasting all the charts you make into a word file, also include your r
code. Bonus points for making your charts look nice. Pretend you’re
publishing them somewhere for public consumption! (hint:
<code>ggthemes</code> offers a nice set of canned themes…)</strong></p>
</div>
<div id="task-2-merit-order-data" class="section level1">
<h1>Task 2: Merit Order data</h1>
<p>Now i want you to pull some historical merit order data to plot the
supply curve (merit order) for various hours, for various companies, and
for various assets.</p>
<p>Let’s start by pulling the data for a random day, let’s go with
<code>2022-08-06</code> as our day:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>get_merit <span class="ot">&lt;-</span> <span class="cf">function</span>(start_date,end_date,aeso_key){</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="at">url=</span><span class="st">&quot;https://api.aeso.ca/report/v1/meritOrder/energy&quot;</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">add_headers</span>(<span class="st">&quot;X-API-Key&quot;</span> <span class="ot">=</span> aeso_key),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">query =</span> <span class="fu">list</span>(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">startDate =</span> <span class="fu">format</span>(start_date, <span class="st">&quot;%Y-%m-%d&quot;</span>),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">endDate =</span> <span class="fu">format</span>(end_date, <span class="st">&quot;%Y-%m-%d&quot;</span>),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">contentType =</span> <span class="st">&quot;application/json&quot;</span>))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(data<span class="sc">$</span>content)))</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-08-06&quot;</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-08-06&quot;</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>meritOrder <span class="ot">&lt;-</span> <span class="fu">get_merit</span>(start_date,end_date,aeso_key)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>meritOrder <span class="ot">&lt;-</span> <span class="fu">unnest</span>(meritOrder, <span class="at">cols =</span> <span class="fu">c</span>(return.data.energy_blocks))</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(meritOrder)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 16
##   timestamp      responseCode return.data.beg… return.data.beg… import_or_export
##   &lt;fct&gt;          &lt;fct&gt;        &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;           
## 1 2023-02-03 16… 200          2022-08-06 06:00 2022-08-06 00:00 &quot;&quot;              
## 2 2023-02-03 16… 200          2022-08-06 06:00 2022-08-06 00:00 &quot;&quot;              
## 3 2023-02-03 16… 200          2022-08-06 06:00 2022-08-06 00:00 &quot;&quot;              
## 4 2023-02-03 16… 200          2022-08-06 06:00 2022-08-06 00:00 &quot;&quot;              
## 5 2023-02-03 16… 200          2022-08-06 06:00 2022-08-06 00:00 &quot;&quot;              
## 6 2023-02-03 16… 200          2022-08-06 06:00 2022-08-06 00:00 &quot;&quot;              
## # … with 11 more variables: asset_ID &lt;chr&gt;, block_number &lt;int&gt;,
## #   block_price &lt;chr&gt;, from_MW &lt;int&gt;, to_MW &lt;int&gt;, block_size &lt;int&gt;,
## #   available_MW &lt;int&gt;, `dispatched?` &lt;chr&gt;, dispatched_MW &lt;int&gt;,
## #   `flexible?` &lt;chr&gt;, offer_control &lt;chr&gt;</code></pre>
<p>Now you should have a dataframe to work with thanks to Mallika’s
smart use of the <code>unnest</code> command.</p>
<p>Let’s clean it up a bit by renaming some variables we will want to
work with.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>meritOrder <span class="ot">&lt;-</span> meritOrder <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">time=</span>return.data.begin_dateTime_mpt,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">MW=</span>available_MW,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">price=</span>block_price)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(meritOrder)</span></code></pre></div>
<pre><code>## tibble [5,362 × 16] (S3: tbl_df/tbl/data.frame)
##  $ timestamp                     : Factor w/ 1 level &quot;2023-02-03 16:43:38.633+0000&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ responseCode                  : Factor w/ 1 level &quot;200&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ return.data.begin_dateTime_utc: chr [1:5362] &quot;2022-08-06 06:00&quot; &quot;2022-08-06 06:00&quot; &quot;2022-08-06 06:00&quot; &quot;2022-08-06 06:00&quot; ...
##  $ time                          : chr [1:5362] &quot;2022-08-06 00:00&quot; &quot;2022-08-06 00:00&quot; &quot;2022-08-06 00:00&quot; &quot;2022-08-06 00:00&quot; ...
##  $ import_or_export              : chr [1:5362] &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
##  $ asset_ID                      : chr [1:5362] &quot;ME04&quot; &quot;BHL1&quot; &quot;COD1&quot; &quot;ICP1&quot; ...
##  $ block_number                  : int [1:5362] 1 1 1 1 1 1 1 1 1 6 ...
##  $ price                         : chr [1:5362] &quot;999.99&quot; &quot;999.99&quot; &quot;999.99&quot; &quot;999.99&quot; ...
##  $ from_MW                       : int [1:5362] 4 3 3 4 4 18 3 4 4 49 ...
##  $ to_MW                         : int [1:5362] 6 5 5 7 7 21 6 7 8 54 ...
##  $ block_size                    : int [1:5362] 2 2 2 3 3 3 3 3 4 5 ...
##  $ MW                            : int [1:5362] 2 2 2 3 3 3 3 3 4 0 ...
##  $ dispatched?                   : chr [1:5362] &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ dispatched_MW                 : int [1:5362] 0 0 0 0 0 0 0 0 0 0 ...
##  $ flexible?                     : chr [1:5362] &quot;Y&quot; &quot;Y&quot; &quot;Y&quot; &quot;N&quot; ...
##  $ offer_control                 : chr [1:5362] &quot;URICA Asset Optimization Ltd.&quot; &quot;URICA Asset Optimization Ltd.&quot; &quot;Signalta Resources Limited&quot; &quot;URICA Asset Optimization Ltd.&quot; ...</code></pre>
<p>Better. But we have our familiar data class issue. Price is a
character. That’s no good! So is our time variable.</p>
<p>I want you to do three things now: 1. Convert price and MW to numeric
variables (remember your <code>mutate</code>). 2. Convert time to a
POSIXct variable (<code>ymd_hm</code> is your friend) 3. Create a new
<code>hour</code> variable using <code>hour</code> function on your time
variable 4. I lied. 4 things. I also want you to <code>filter</code> out
all the imports and exports. They are marked with either an
<code>I</code> or <code>E</code> in the <code>import_or_export</code>
column.</p>
<p>When done, it should look like this:</p>
<pre><code>## tibble [5,250 × 17] (S3: tbl_df/tbl/data.frame)
##  $ timestamp                     : Factor w/ 1 level &quot;2023-02-03 16:43:38.633+0000&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ responseCode                  : Factor w/ 1 level &quot;200&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ return.data.begin_dateTime_utc: chr [1:5250] &quot;2022-08-06 06:00&quot; &quot;2022-08-06 06:00&quot; &quot;2022-08-06 06:00&quot; &quot;2022-08-06 06:00&quot; ...
##  $ time                          : POSIXct[1:5250], format: &quot;2022-08-06 00:00:00&quot; &quot;2022-08-06 00:00:00&quot; ...
##  $ import_or_export              : chr [1:5250] &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
##  $ asset_ID                      : chr [1:5250] &quot;ME04&quot; &quot;BHL1&quot; &quot;COD1&quot; &quot;ICP1&quot; ...
##  $ block_number                  : int [1:5250] 1 1 1 1 1 1 1 1 1 6 ...
##  $ price                         : num [1:5250] 1000 1000 1000 1000 1000 ...
##  $ from_MW                       : int [1:5250] 4 3 3 4 4 18 3 4 4 49 ...
##  $ to_MW                         : int [1:5250] 6 5 5 7 7 21 6 7 8 54 ...
##  $ block_size                    : int [1:5250] 2 2 2 3 3 3 3 3 4 5 ...
##  $ MW                            : num [1:5250] 2 2 2 3 3 3 3 3 4 0 ...
##  $ dispatched?                   : chr [1:5250] &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ dispatched_MW                 : int [1:5250] 0 0 0 0 0 0 0 0 0 0 ...
##  $ flexible?                     : chr [1:5250] &quot;Y&quot; &quot;Y&quot; &quot;Y&quot; &quot;N&quot; ...
##  $ offer_control                 : chr [1:5250] &quot;URICA Asset Optimization Ltd.&quot; &quot;URICA Asset Optimization Ltd.&quot; &quot;Signalta Resources Limited&quot; &quot;URICA Asset Optimization Ltd.&quot; ...
##  $ hour                          : int [1:5250] 0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<p>Good. We can work with this.</p>
<p>Now we are ready to create our cumulative offer curves. I’m going to
hide this step because this is where the magic happens. Remember, you’ve
got a bunch of rows in your dataframe, each of which are for different
offer blocks, of different assets, on potentially different hours.</p>
<p>The trick here is to use 3 steps:</p>
<ol style="list-style-type: decimal">
<li>First, use the <code>arrange</code> command on your dataframe to
order the data properly</li>
<li>Second, use the <code>group_by</code> command to create cumulative
supply curves <em>by hour</em></li>
<li>Third, you will need to create a new variable, let’s call it
<code>cumul_MW</code> that is, no surprise, the cumulative MWs offered
in that hour.</li>
</ol>
<p>Ok, i’ve done that. Once you have, you should be able to plot a merit
order for a single hour like this. Let’s choose hour beginning
12:00:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot 1 hour</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(meritOrder <span class="sc">%&gt;%</span> <span class="fu">filter</span>(hour<span class="sc">==</span><span class="dv">12</span>), <span class="fu">aes</span>(cumul_MW,price))<span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">direction=</span><span class="st">&quot;vh&quot;</span>)<span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_clean</span>()</span></code></pre></div>
<p><img src="assignment1_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>You might have noticed i used a new plotting command:
<code>geom_step</code>. How very observant of you. Honestly, for this
market merit order i could have just done <code>geom_line</code> and it
would have looked similar to the numerous blocks. But using
<code>geom_step</code> will be more important when we look at individual
assets, where the steps are more chunky. We want these plotted as step
curves, not angled lines connecting points. The
<code>direction="vh"</code> option tells ggplot i want my steps to go
vertical then horizontal (the default is horizontal then vertical, which
we don’t want here)</p>
<p><strong>Now your tasks</strong></p>
<ol style="list-style-type: decimal">
<li><p>Produce the single hourly plot i did above.</p></li>
<li><p>Produce a plot with the <strong>24 hours</strong> of August 6 as
different lines. I suggest using <code>scale_color_viridis_d</code> as
your color palette, but that’s up to you. Note: if you just use
<code>color=hour</code> in your ggplot aesthetics, it will treat
<code>hour</code> and the colorscale as continuous variables. We don’t
want that. We want discrete hours. To make that so, use
<code>color=factor(hour)</code>, which turns the hour variable into 24
discrete values when plotting.</p></li>
<li><p>Plot just the merit order for a <strong>single company</strong>,
also showing all 24 hours as colored lines. I want you to do this for
each of (a) Transalta, (b) Capital Power, and (c) Heartland Generation.
You’ll notice they have lots of companies with their names in them. Use
them all. To help you, check out the <code>str_detect</code> function…
Note: Once you’ve done a <code>filter</code> on just the company you
want, you’ll again need to do the <code>arrange</code>
<code>group_by</code> <code>mutate</code> steps to create your
cumulative MW variables!</p></li>
<li><p>Plot just the merit order for a <strong>single asset</strong>,
again for all 24 hours. I want you to do this for each of (a) Shepard,
(b) Keephills 3, (c) Sheerness 2, and (d) Sundance 6. Same note applies
as in (3): you’ll need to recreate your merit orders after filtering on
each asset again.</p></li>
</ol>
<p>As a freebie, here is my plot for the Sheerness 2 merit order:</p>
<p><img src="assignment1_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>That one is a bit hard to read, so I’ll also show it as a faceted
graph using <code>facet_wrap(~factor(hour))</code></p>
<p><img src="assignment1_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Very nice…</p>
<p>Now it’s your turn. <strong>Go forth and plot!</strong></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
